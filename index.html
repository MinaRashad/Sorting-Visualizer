<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Sorting Visualizer</title>
        <style>
            *{
                margin: 0;
                padding: 0;
            }

            #canvs{
                position: absolute;
                right: 10%;
                top: 0;
                border: 0.1vw gray solid;
            }

            #form, button, select{
                margin: 1vw;
                font-size: 2vw;
            }
            button{
                padding-left: 2vw;
                padding-right: 2vw;
                padding-top: 1vw;
                padding-bottom: 1vw;

            }
        </style>
    </head>
    <body>
        <div>
        <form id="form">
            
            <label>Sorting Algorithm</label>
            <select id="algorithm"">
                <option value="bubble">Bubble Sort</option>
                <option value="insertion">Insertion Sort</option>
                <option value="selection">Selection Sort</option>
                <option value="merge">Merge Sort</option>
                <option value="quick">Quick Sort</option>
                <option value="heap">Heap Sort</option>
                <option value="radix">Radix Sort (Binary)</option>
            </select><br>
            <button id="shuffle">
                Shuffle
            </button>
            <button id="sort">
                Sort!
            </button>
        </form>
        <div>
            comparison: <span id="comparisons">0</span> 
        </div>
    </div>
            <canvas id="canvs">

            </canvas>
        <script>

            let canvs = document.getElementById("canvs");
            let ctx = canvs.getContext("2d");

            const WIDTH = Math.min(window.innerHeight,window.innerWidth);
            const HEIGHT = WIDTH;

            canvs.width = WIDTH;
            canvs.height = HEIGHT;
            clear()

            // the user inputs
            let algorithm_DOM = document.getElementById("algorithm");
            let shuffle_btn = document.getElementById("shuffle");
            let sort_btn = document.getElementById("sort");
            
            // output
            let num_of_comparisons = 0;
            let comparison_DOM = document.getElementById("comparisons");


            // init array and trackers
            let main_array = []
            let red_idxs = []
            let algorithm = ""
            let counter = 0
            let sorted = true

            for (let i = 0; i < HEIGHT; i++) {
                main_array[i] = i
                
            }

            //Basic functions
                function clear(){
                    ctx.fillStyle = "black";
                    ctx.fillRect(0, 0, WIDTH, HEIGHT);
                }

                function drawBar(x,width,height,color="white"){
                    ctx.fillStyle = color
                    ctx.fillRect(x,HEIGHT-height,width,height)
                }
                
                function swap(arr,i,j){
                    let temp = arr[i]
                    arr[i] = arr[j]
                    arr[j] = temp 
                }

            //complex drawing functions
            function draw_main(arr, red_idxs = []){
                for(let i=0; i<arr.length; i++){
                    // draw arr, color red if needed
                    drawBar(i,1,arr[i], red_idxs.indexOf(i) == -1 ? "white" : "red")
                }
            }
            
            //event listeners
            shuffle_btn.addEventListener("click",(event)=>{
                event.preventDefault();
                algorithm = "shuffle";
            })

            sort_btn.addEventListener("click",(event)=>{
                event.preventDefault();
                algorithm=algorithm_DOM.value
                // do here resetings needed before changing algorithm
                num_of_comparisons = 0

                //bubble
                i=0, last_item = main_array.length-1
                swaps_num = 0

                //selection
                selection_max = -Infinity;
                selection_idx = 0;
                max_idx = -1
                position_of_max = main_array.length-1



            })
            
            // Main process
            function draw(){
                clear()
                draw_main(main_array,red_idxs)

                if (algorithm == "shuffle") {
                    shuffle()
                }
                if(!sorted){
                    if(algorithm == "bubble"){
                        for(let n=0; n<100;n++) bubble()
                    }
                    if(algorithm == "selection") {
                        for(let n=0; n<1000;n++) selection()
                    }
                    if(algorithm == "radix"){
                        radix()
                    }
                }

                comparison_DOM.innerText = num_of_comparisons
            }

            // algorithms
            function shuffle(){
                sorted = false
                red_idxs = []

                    for(let i =0; i<100; i++){
                        let first = Math.round(Math.random() * (main_array.length-1))
                        let second = Math.round(Math.random() * (main_array.length-1))
                        red_idxs = [...red_idxs,first,second]
                        swap(main_array,first,second)
                        counter++
                    }
                    

                    if(counter > 1000){
                        algorithm = ""
                        counter = 0
                        red_idxs = []
                    }
            }

            // bubble sort
            // variables needed
            let i=0, last_item = main_array.length-1
            let swaps_num = 0

            function bubble(){
                if(i >= last_item){
                    i=0;
                    num_of_comparisons += 1

                    if(swaps_num == 0){
                        sorted = true
                        last_item = main_array.length-1

                    }else{
                        last_item -=1
                    }
                    swaps_num =0

                }
                if(main_array[i] > main_array[i+1])
                {
                    swap(main_array,i,i+1)
                    swaps_num += 1
                    num_of_comparisons += 1
                }
                i+=1
                red_idxs = [i,i+1]
            }
            
            // selection sort
            // variables
            let selection_idx = 0;
            let selection_max = -Infinity;
            let max_idx = -1
            let position_of_max = main_array.length-1

            function selection(){
                if(main_array[selection_idx] > selection_max){
                    selection_max = main_array[selection_idx]
                    max_idx = selection_idx

                    num_of_comparisons += 1
                }

                red_idxs = [selection_idx, max_idx]

                if(selection_idx >= position_of_max){
                    swap(main_array, position_of_max, max_idx)
                    position_of_max -= 1
                    selection_max = -Infinity;
                    selection_idx = 0;
                    max_idx = -1
                }else{
                    selection_idx +=1
                }

                if (position_of_max == 0) {
                    algorithm = ""
                    sorted = true

                }
            }
            
            // radix
            // we need to do a transition from old array to new array
            const MAX_ITERATIONS = Math.ceil(Math.log2(Math.max(...main_array)))
            let radix_iteration = 0
            let radix_counter = 0
            function radix(){
                if(radix_iteration >= MAX_ITERATIONS){
                    algorithm = ""
                    sorted = true
                    red_idxs = []
                }
                let zeros = []
                let ones = []
                if(radix_counter % 5 == 0){
                    red_idxs = []
                    for(let idx=0; idx<main_array.length;idx++){
                        if(main_array[idx] & 1<<radix_iteration){
                            ones.push(main_array[idx])
                        }
                        else{
                            red_idxs.push(idx)
                            zeros.push(main_array[idx])
                        }
                    }
                    main_array = [...zeros,...ones]
                    radix_iteration +=1
                    
                }

                radix_counter++
                

                

            }
            
            setInterval(draw, 100);
        </script>
    </body>
</html>
